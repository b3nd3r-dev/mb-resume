- package:
    name: "{{ item }}"
  loop:
  - python3
  - python3.10-venv
  - npm
  - libpq-dev
  become: yes

- name: Install requirements & create virtual environment
  pip: 
    requirements: "{{ project_dir }}/requirements.txt"
    virtualenv: "{{ project_dir }}/venv"
    virtualenv_command: python3 -m venv

- name: Template Development environment variables
  copy:
    dest: "{{ project_dir }}/envvars_dev"
    content: "{{ content_to_write }}"
  vars:
    content_to_write: | 
      export FLASK_APP=flask_app.py
      export FLASK_CONFIG=development
      export SECRET_KEY=abc123
  
- name: Template Production environment variables
  copy:
    dest: "{{ project_dir }}/envvars_prod"
    content: "{{ content_to_write }}"
  vars:
    content_to_write: | 
      export FLASK_APP=flask_app.py
      export FLASK_CONFIG=production
      export SECRET_KEY=#REPLACEMEeeeee